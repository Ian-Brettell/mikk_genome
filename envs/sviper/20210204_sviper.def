Bootstrap: docker
From: gcc:5.4.0

%environment
    export LC_ALL="en_US.UTF-8"
    export LC_CTYPE="en_US.UTF-8"

%post
    # Install cmake
    wget https://github.com/Kitware/CMake/releases/download/v3.19.4/cmake-3.19.4-Linux-x86_64.sh
    chmod +x ./cmake-3.19.4-Linux-x86_64.sh
    ./cmake-3.19.4-Linux-x86_64.sh

    # Download SViper

    git clone --recursive https://github.com/smehringer/SViper.git
    cd SViper
    mkdir build
    cd build
    cmake ..
    make sviper

#    # Mount paths to Nvidia driver file (added to env above)
#
#    mkdir /nvlib /nvbin
#


    # Install Miniconda

#    wget -c https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
#    /bin/bash Miniconda3-latest-Linux-x86_64.sh -bfp /opt/conda
#    export PATH="/opt/conda/bin:$PATH"
#    # Conda configuration of channels from .condarc file
#    conda config --file /.condarc --add channels defaults
#    conda config --file /.condarc --add channels conda-forge
#    conda update conda

#    # Install conda env from idtrackerai_gpu.yaml file (doesn't work, but keep for future reference)
#
#    echo ". /opt/conda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
#    echo "conda activate $(head -1 idtrackerai_gpu.yaml | cut -d' ' -f2)" >> $SINGULARITY_ENVIRONMENT
#    /opt/conda/bin/conda env create -n idtrackerai -f /hps/research1/birney/users/ian/pilot/idtrackerai_gpu.yaml

#    # Activate env and install dependencies
#
#    . /opt/conda/etc/profile.d/conda.sh
#    conda create -n idtrackerai python=3.6
#    conda activate idtrackerai
#    pip install idtrackerai==3.0.24
#    conda install tensorflow-gpu=1.13

#    echo ". /opt/conda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
#    echo ". activate idtrackerai" >> $SINGULARITY_ENVIRONMENT
